<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Tiny Embeddable Physics Engine: Documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Tiny Embeddable Physics Engine
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Documentation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="main-purpose"></a>
Purpose </h1>
<p>TEPE is a lightweight physics engine. It particularly has a compile-time defined and somewhat minimal memory usage. It was designed to run as a GPU kernel, enabling numerous concurrent simulator instances to be set up (by for example using CUDA from Nvidia). TEPE is completely designed as a collection of inline functions in a set of header files. It uses the well known Projected Gauss-Seidel iterative solver. This ensures small memory requirements, and can be implemented so that GPU thread divergence is avoided, even when simulation worlds contain different amounts of constraints.</p>
<p>In its current state it is most suitable for simulating mobile walking robots. Currently the only supported constraint is the hinge joint which can have a motor attached. There is no general collision detection, instead there is a simple "foot collision", where certain bodies tagged as "feet" are collided against a plane.</p>
<h1><a class="anchor" id="main-usage"></a>
Usage </h1>
<p>In order to use TEPE, initiate the engine in an application by first at least defining <a class="el" href="group__tp-usage.html#ga6f6d984c89fafe067d3dea72a1799d72" title="Should be set to the number of bodies.">TP_BODIES</a>, <a class="el" href="group__tp-usage.html#ga6b817139d6232afa139bcf125d417dec" title="Should be set to the number of hinges.">TP_HINGES</a>, <a class="el" href="group__tp-usage.html#gaef1185b3705bc7d990f87dae9801fe57" title="Should be set to the number of motors.">TP_MOTORS</a> and <a class="el" href="group__tp-usage.html#ga342dc93ba1501b0c7fe1fcda0d0dfc3f" title="Should be set to the number of bodies that act as feet.">TP_FEET</a>. In addition to these mandatory definitions there are also some macros that tune the simulator behaviour, see <a class="el" href="group__tp-usage.html">Settings and Usage</a>. After defining the necessary macros the simulator is available by including <a class="el" href="tp_8h_source.html">tp.h</a>. For two bodies, connected by a motor powered hinge which have no contact with the ground one should use: </p>
<div class="fragment"><div class="line"><span class="preprocessor">#define TP_BODIES       2</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define TP_HINGES       1</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define TP_MOTORS       1</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define TP_FEET         0</span></div>
<div class="line"><span class="preprocessor">#include &lt;tp/tp.h&gt;</span></div>
</div><!-- fragment --><p> Using the above setup lines, a default memory layout and a default type setting are used. These can easily be changed by defining the <a class="el" href="group__tp-usage.html#ga7333a70f2ec1176a11f11b7c4afd7f8d" title="Defines the memory header/implementation to be used.">TP_MEM</a> and <a class="el" href="group__tp-usage.html#gaa81066251a8581a2bda32f47d194872c" title="Defines the type header to be used.">TP_TYPES</a> macros. For information on memory access and type settings, see <a class="el" href="group__tp-mem.html">Memory</a> and <a class="el" href="group__tp-types.html">Types</a>. These sections provide information on how to implement custom memory layouts and type settings. TEPE includes besides the default settings also settings that are useful for the Nvidia CUDA environment. To use these in the previous example, setup TEPE as: </p>
<div class="fragment"><div class="line"><span class="preprocessor">#define TP_BODIES       2</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define TP_HINGES       1</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define TP_MOTORS       1</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define TP_FEET         0</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define TP_MEM          &quot;memory/cudaopt.h&quot;</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define TP_TYPES        &quot;types/cuda.h&quot;</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#include &lt;tp/tp.h&gt;</span></div>
</div><!-- fragment --><p> Once the "setup" of TEPE is completed, one should allocate the simulation world memory. One could have all the memory on the stack or dynamically allocate it, the functions operating on the memory will always take a pointer to the memory structure. Also worth noting is that the exact definition of the structure will vary between different memory allocation layouts. </p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>mem_t *memory_pointer = malloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> mem_t));</div>
</div><!-- fragment --><p> After the memory has been allocated it is time to define the inertia of all the bodies in the simulation world. This can be done by using the memory access methods described in <a class="el" href="group__tp-mem.html">Memory</a>. For instance, to set the inertia tensor (or actually the inverse in the body frame) of the first body, one first declare and initialize a local matrix to hold the values, </p>
<div class="fragment"><div class="line">tp_mtx inertia;</div>
<div class="line">inertia[0] = ...</div>
<div class="line">...</div>
<div class="line">inertia[1*<a class="code" href="group__tp-types.html#ga9240af5aaafe09d7f26d0007b6ad72b3" title="The size of a three dimensional array in number of elements.">TP_SIZE_VEC3</a>] = ...</div>
<div class="line">...</div>
<div class="line">inertia[2*<a class="code" href="group__tp-types.html#ga9240af5aaafe09d7f26d0007b6ad72b3" title="The size of a three dimensional array in number of elements.">TP_SIZE_VEC3</a>+2] = ...</div>
</div><!-- fragment --><p> and then store it into the simulation memory, in the place of the first body, </p>
<div class="fragment"><div class="line"><a class="code" href="group__tp-mem.html#ga74c7f95ae03ad1ad1676d3216f8bc74f" title="Writes a local 3x3 matrix to memory.">set_mtx33</a>(inertia, <a class="code" href="group__tp-mem.html#ga7eae98d17c5ed46bf34155f54a99b8c3" title="Returns a memory pointer to the inverse inertia tensior of a body.">Ibi</a>(memory_pointer, 0));</div>
</div><!-- fragment --><p> See <a class="el" href="group__tp-mem.html">Memory</a> for more on how to access memory. For boxes and cylinders, TP include a pair of convinience functions for setting the inertia, see <a class="el" href="group__tp-dynamics.html#ga4d9216df674eb768ff062d136a44de31">set_box_inertia</a> and <a class="el" href="group__tp-dynamics.html#gad5fd720b14d0257094eeae1894cb6e55">set_cylinder_inertia</a>.</p>
<p>Hinges are setup between bodies using the <a class="el" href="group__tp-dynamics.html#ga8c32f3b9013296a488dcc9d82af7ebf2">create_hinge</a> function while a motor is added to a hinge by using the <a class="el" href="group__tp-dynamics.html#ga7a5b5b87c6e84b84b9a0b8561f61b8a5">add_motor</a> function.</p>
<p>Once the world is configured, the simulation loop can be run as follows. If there are any "feet" present these can be collided to the ground by using a loop similar to: </p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> contacts_offset = 0;        </div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">int</span> foot = 0; foot &lt; (<a class="code" href="group__tp-usage.html#ga342dc93ba1501b0c7fe1fcda0d0dfc3f" title="Should be set to the number of bodies that act as feet.">TP_FEET</a>); ++foot)</div>
<div class="line">{</div>
<div class="line">    contacts_offset += <a class="code" href="group__tp-collision.html#gaee7ae149513c964f0ac7253afae4d9df" title="Collides a body as a cylindrical foot against the terrain.">collide_foot_cylinder_tri</a>(</div>
<div class="line">                            memory_pointer,</div>
<div class="line">                            foot_radius_m,</div>
<div class="line">                            foot_height_m,</div>
<div class="line">                            contacts_offset,</div>
<div class="line">                            feet_index[foot]);</div>
<div class="line">}</div>
</div><!-- fragment --><p> Here <em>feet_index</em> is an array that holds the index of the bodies that are considered to be"feet". The above code snippet will configure the necessary constraints in the case a contact is found. External forces should also be added before stepping the world. To add gravity to all bodies: </p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">int</span> body = 0; body &lt; (<a class="code" href="group__tp-usage.html#ga6f6d984c89fafe067d3dea72a1799d72" title="Should be set to the number of bodies.">TP_BODIES</a>); ++body) </div>
<div class="line">    *<a class="code" href="group__tp-mem.html#gad102843f56cd0929a0efbf23ee8409fc" title="Returns a pointer to the third element in a 3D vector.">z</a>(<a class="code" href="group__tp-mem.html#ga671b166434d14e3f3b17993c20554b51" title="Returns a memory pointer to the translation external force acting on a body.">tFe</a>(memory_pointer, body)) += -9.81*(1.0/<a class="code" href="group__tp-mem.html#ga7ca37d1eac76cb86c919f295deff2ee7" title="Returns the inverse mass of a body.">_mi</a>(memory_pointer, body));</div>
</div><!-- fragment --><p> The final step is to step the world: </p>
<div class="fragment"><div class="line"><a class="code" href="group__tp-dynamics.html#ga1f41f320af39f3f4fe513001f061dea2" title="Steps a simulation world a dt amount of seconds.">step_world</a>(memory_pointer, dt, iterations);</div>
</div><!-- fragment --> <h1><a class="anchor" id="main-dev"></a>
Development </h1>
<p>When modifying TEPE there is a convinient debug header that provides some functions to printout vectors and memory. To enable this, configure TEPE, by defining the <a class="el" href="group__tp-dev.html#ga101eb1f242994c1c4db05d9df04fccc1" title="Define this macro to activate debug functionality.">TP_DEBUG</a> macro and prepending the <a class="el" href="tp_8h_source.html">tp.h</a> include by <a class="el" href="tp-core_8h_source.html">tp-core.h</a> and <a class="el" href="debugging_8h_source.html">debugging.h</a>. </p>
<div class="fragment"><div class="line"><span class="preprocessor">#define TP_BODIES       2</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define TP_HINGES       1</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define TP_MOTORS       1</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define TP_FEET         0</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define TP_DEBUG</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#include &lt;tp/tp-core.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;tp/debugging.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;tp/tp.h&gt;</span></div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Dec 17 2013 23:35:33 for Tiny Embeddable Physics Engine by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.2
</small></address>
</body>
</html>
